<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forever With Me üå∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---------------- GENERAL ---------------- */
html,body{
  margin:0; padding:0; height:100%;
  font-family:'Georgia', serif;
  overflow:hidden;
}

#bg{
  position:fixed; inset:0;
  background-size:cover;
  background-position:center;
  transition:opacity 1.5s ease;
}

.overlay{
  position:fixed; inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.55),rgba(255,182,193,.2));
}

/* ---------------- CARD ---------------- */
.card{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(14px);
  border-radius:22px;
  padding:26px 24px;
  text-align:center;
  color:white;
  max-width:92vw;
  width:420px;
  box-shadow:0 0 30px rgba(255,255,255,.15);
}

/* ---------------- TEXT ---------------- */
h1{font-size:1.5rem;margin-top:0}
#finalMessage{
  min-height:80px;
  font-size:1.05rem;
  line-height:1.5;
  opacity:0;
  transition:opacity .8s ease;
}

/* ---------------- INPUTS ---------------- */
input,textarea{
  border-radius:12px;
  border:none;
  padding:10px;
  width:90%;
  max-width:320px;
}

/* ---------------- BUTTONS ---------------- */
button{
  padding:12px 22px;
  border:none;
  border-radius:30px;
  cursor:pointer;
  font-size:16px;
  margin:8px;
}
#yes{background:#ff9acb;color:white;}
#no{background:white;color:black;position:relative;}

button:focus{outline:2px solid white}

/* ---------------- PROGRESS ---------------- */
#progressWrap{
  position:fixed;
  top:0; left:0;
  width:100%;
  height:6px;
  background:rgba(255,255,255,.2);
  z-index:5;
}
#progress{
  height:100%;
  width:0%;
  background:pink;
  transition:width .5s linear;
}

/* ---------------- PETALS ---------------- */
.petal{
  position:absolute;
  width:14px;height:14px;
  background:pink;
  opacity:.6;
  border-radius:50%;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);}
}

/* ---------------- SPARKLES ---------------- */
.sparkle{
  position:absolute;
  width:6px;height:6px;
  border-radius:50%;
  background:white;
  opacity:.8;
  pointer-events:none;
  animation:spark .8s forwards;
}
@keyframes spark{
  to{opacity:0;transform:scale(2);}
}

/* ---------------- END SCREEN ---------------- */
#ending{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  text-align:center;
  color:white;
  font-size:1.2rem;
  backdrop-filter:blur(4px);
}

/* ---------------- MOBILE ---------------- */
@media(max-width:480px){
  h1{font-size:1.25rem;}
  #finalMessage{font-size:.95rem;}
}
</style>
</head>
<body>

<div id="bg"></div>
<div class="overlay"></div>

<div id="progressWrap"><div id="progress"></div></div>

<div class="card" id="card">

<h1 id="greeting">Will You Stay In My Story? üå∏</h1>

<div id="nameInput">
<label>Sender name</label><br>
<input id="senderName"><br><br>

<label>Receiver name</label><br>
<input id="receiverName"><br><br>

<label>Special day</label><br>
<input type="date" id="birthday"><br><br>

<button id="startBtn">Start üíñ</button>
</div>

<div id="buttons" style="display:none">
<button id="yes">Yes üíñ</button>
<button id="no">No üôà</button>

<div id="finalMessage"></div>

<br>
<button id="voiceBtn">üîä Play my voice</button>
<span id="voiceStatus"></span>
</div>

<div id="game" style="display:none">
<br>
<textarea id="receiverFeelings" placeholder="Write your feelings here..."></textarea><br><br>
<button id="saveBtn">Save our moment üíç</button>

<h2 id="receiverMessage">Do you want to say something too?</h2>
<button id="loveYes">I like you too üíï</button>
<button id="loveNo">Maybe later üå∏</button>
</div>

</div>

<div id="ending">
  <div>
    Thank you for staying until the end üå∏<br>
    Your moment is safely saved.
  </div>
</div>

<audio id="music" src="obhodro.mp3" loop></audio>
<audio id="voice" src="voice.mp3"></audio>

<script>
/* ======================================================
   STATE
====================================================== */
let sender="",receiver="",birthday="";
let sparkleLock=false;
let petals=[];
let storyRunning=false;

/* ======================================================
   INDIA BACKGROUNDS + THEMES
====================================================== */
const themes=[
{
 name:"Taj",
 img:"https://source.unsplash.com/1600x900/?taj,mahal,agra,india",
 overlay:"rgba(255,182,193,.2)"
},
{
 name:"Varanasi",
 img:"https://source.unsplash.com/1600x900/?varanasi,ghats,ganges,india",
 overlay:"rgba(255,200,150,.18)"
},
{
 name:"Munnar",
 img:"https://source.unsplash.com/1600x900/?munnar,tea,plantation,kerala,india",
 overlay:"rgba(180,255,200,.15)"
},
{
 name:"Hawa",
 img:"https://source.unsplash.com/1600x900/?hawa,mahal,jaipur,india",
 overlay:"rgba(255,210,210,.18)"
},
{
 name:"Dal",
 img:"https://source.unsplash.com/1600x900/?dal,lake,srinagar,india",
 overlay:"rgba(180,210,255,.18)"
}
];

let themeIndex=0;
const bg=document.getElementById("bg");
const overlay=document.querySelector(".overlay");

function changeTheme(){
  bg.style.opacity=0;
  setTimeout(()=>{
    bg.style.backgroundImage=`url('${themes[themeIndex].img}')`;
    overlay.style.background=
      `linear-gradient(to top,rgba(0,0,0,.55),${themes[themeIndex].overlay})`;
    bg.style.opacity=1;
    themeIndex=(themeIndex+1)%themes.length;
  },700);
}
changeTheme();
setInterval(()=>{ if(!endingShown) changeTheme(); },12000);

/* ======================================================
   PETALS POOL (PERFORMANCE SAFE)
====================================================== */
function initPetals(){
  for(let i=0;i<18;i++){
    let p=document.createElement("div");
    p.className="petal";
    resetPetal(p);
    document.body.appendChild(p);
    petals.push(p);
  }
}
function resetPetal(p){
  p.style.left=Math.random()*100+"vw";
  p.style.top=(-20-Math.random()*100)+"px";
  p.style.animationDuration=(8+Math.random()*6)+"s";
}
initPetals();

/* ======================================================
   SPARKLES (THROTTLED)
====================================================== */
let lastSpark=0;
document.addEventListener("mousemove",e=>{
  if(Date.now()-lastSpark<40 || sparkleLock) return;
  lastSpark=Date.now();
  let s=document.createElement("div");
  s.className="sparkle";
  s.style.left=e.pageX+"px";
  s.style.top=e.pageY+"px";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),800);
});

/* ======================================================
   AUDIO MANAGER
====================================================== */
const music=document.getElementById("music");
const voice=document.getElementById("voice");
const voiceBtn=document.getElementById("voiceBtn");
const voiceStatus=document.getElementById("voiceStatus");

function fadeInMusic(){
  music.volume=0;
  music.play();
  let v=0;
  let i=setInterval(()=>{
    v+=0.05;
    music.volume=Math.min(v,0.6);
    if(v>=0.6) clearInterval(i);
  },150);
}

voiceBtn.addEventListener("click",()=>{
  voiceBtn.disabled=true;
  voiceStatus.textContent=" Playing‚Ä¶";
  music.volume=0.25;
  voice.play();
});

voice.onended=()=>{
  voiceBtn.disabled=false;
  voiceStatus.textContent="";
  music.volume=0.6;
};

/* ======================================================
   START
====================================================== */
document.getElementById("startBtn").onclick=()=>{
  sender=clean(document.getElementById("senderName").value)||"You";
  receiver=clean(document.getElementById("receiverName").value)||"Someone special";
  birthday=document.getElementById("birthday").value||"a special day";

  document.getElementById("nameInput").style.display="none";
  document.getElementById("buttons").style.display="block";
  document.getElementById("greeting").innerText=
    `Hey ${receiver}, ${sender} has something for you üå∏`;

  fadeInMusic();
};

/* ======================================================
   NO BUTTON FUN
====================================================== */
const noBtn=document.getElementById("no");
const yesBtn=document.getElementById("yes");

noBtn.onmouseover=()=>{
  noBtn.style.left=Math.random()*(window.innerWidth-100)+"px";
  noBtn.style.top=Math.random()*(window.innerHeight-50)+"px";
};

/* ======================================================
   STORY
====================================================== */
yesBtn.onclick=()=>{
  if(storyRunning) return;
  storyRunning=true;
  startStory();
};

const scenes=[
"I didn‚Äôt notice it at first‚Ä¶",
"But something about you stayed in my mind.",
"Not loudly‚Ä¶ just quietly.",
"Little moments started to feel important.",
"Simple conversations felt warmer.",
"Your smile made ordinary days lighter.",
"Your presence made places feel calmer.",
"Being around you felt natural.",
"Like I didn‚Äôt have to pretend.",
"Or try harder than I already do.",
"From small laughs‚Ä¶",
"To quiet understanding‚Ä¶",
"I slowly felt comfortable being myself.",
`${receiver}, you bring a gentle kind of happiness.`,
"A kind that doesn‚Äôt rush.",
"A kind that stays.",
`From ${sender}'s heart‚Ä¶`,
`Since ${birthday}‚Ä¶`,
"I started appreciating small things more.",
"Your kindness.",
"Your patience.",
"The way you notice little details.",
"You don‚Äôt try to be special.",
"You simply are.",
"And if I‚Äôm honest‚Ä¶",
"I would love more days like this.",
"More smiles like yours.",
"More moments like today.",
"Nothing dramatic.",
"Nothing rushed.",
"Just something real.",
"And something kind. üå∏"
];

let sceneIndex=0;
const finalMsg=document.getElementById("finalMessage");
const progress=document.getElementById("progress");

function startStory(){
  nextScene();
}

function nextScene(){
  if(sceneIndex>=scenes.length){
    finishStory();
    return;
  }

  progress.style.width=
   ((sceneIndex/scenes.length)*100)+"%";

  fadeText(()=>{
    typeWriter(scenes[sceneIndex],()=>{
      sceneIndex++;
      setTimeout(nextScene,5000);
    });
  });
}

function fadeText(cb){
  finalMsg.style.opacity=0;
  setTimeout(()=>{
    finalMsg.innerHTML="";
    finalMsg.style.opacity=1;
    cb();
  },600);
}

function typeWriter(text,done){
  let i=0;
  finalMsg.innerHTML="";
  function t(){
    if(i<text.length){
      finalMsg.innerHTML+=text.charAt(i++);
      setTimeout(t,40);
    }else{
      done&&done();
    }
  }
  t();
}

/* ======================================================
   ENDING
====================================================== */
let endingShown=false;

function finishStory(){
  progress.style.width="100%";
  document.getElementById("game").style.display="block";
}

/* ======================================================
   MINI GAME + SAVE
====================================================== */
const loveYes=document.getElementById("loveYes");
const loveNo=document.getElementById("loveNo");
const receiverMessage=document.getElementById("receiverMessage");

loveYes.onclick=()=>{
  receiverMessage.innerText=
   `${receiver} feels happy sharing this moment with you üå∏`;
};

loveNo.onclick=()=>{
  receiverMessage.innerText=
   `That's completely okay. Take your time üåº`;
};

document.getElementById("saveBtn").onclick=()=>{
  const text=clean(
    document.getElementById("receiverFeelings").value
  );

  const data={
    sender,receiver,text,
    date:new Date().toLocaleString()
  };
  localStorage.setItem("loveMoment",JSON.stringify(data));
  showEnding();
};

/* ======================================================
   END SCREEN
====================================================== */
function showEnding(){
  sparkleLock=true;
  endingShown=true;
  music.volume=0.25;
  document.getElementById("ending").style.display="flex";
}

/* ======================================================
   SANITIZE
====================================================== */
function clean(str){
  return (str||"").replace(/[<>]/g,"");
}

/* ======================================================
   LOAD SAVED
====================================================== */
window.onload=()=>{
  const saved=localStorage.getItem("loveMoment");
  if(saved){
    const d=JSON.parse(saved);
    document.getElementById("greeting").innerText=
     `Your last saved moment with ${d.receiver} üå∏`;
  }
};

/* ======================================================
   ACCESSIBILITY
====================================================== */
document.addEventListener("keydown",e=>{
  if(e.key==="y") yesBtn.click();
  if(e.key==="n") noBtn.dispatchEvent(new Event("mouseover"));
});
</script>
</body>
</html>